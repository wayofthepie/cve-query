package org.vulgr.graphql

import org.springframework.stereotype.Component
import org.vulgr.repository.CveRepository
import org.vulgr.repository.ProductEntity
import org.vulgr.repository.VendorRepository


@Component
class QueryImpl(private val cveRepo: CveRepository, private val vendorRepo: VendorRepository) : Query {

    override fun affectedProducts(cveId: String, limit: Int): List<Product> =
            cveRepo.getAffectedProducts(cveId, limit).map { convert(it) }

    override fun productsOwnedByVendor(vendorId: String, limit: Int): List<Product> =
            vendorRepo.getProductsOwnedByVendor(vendorId, limit).map { convert(it) }

    private fun convert(entity: ProductEntity): Product =
            Product(product = entity.product,
                    version = entity.version,
                    update = entity.update,
                    cpe = entity.cpe,
                    vendor = entity.vendor?.vendorId)
}