package org.vulgr.repository

import org.neo4j.ogm.annotation.*

@NodeEntity(label = "CVE")
data class CVE(@Id @GeneratedValue
               var id: Long? = null,

               @Property(name = "cveId")
               var cveId: String? = null,

               @Property(name = "summary")
               var summary: String? = null,

               @Relationship(type = "Affects", direction = Relationship.OUTGOING)
               var products: List<Product>? = null,

               @Relationship(type = "HasReference", direction = Relationship.OUTGOING)
               var references: List<Reference>? = null,

               @Relationship(type = "CommonWeakness", direction = Relationship.OUTGOING)
               var cwes: List<CWE>? = null)

@NodeEntity(label = "Product")
data class Product(
        @Id @GeneratedValue
        var id: Long? = null,

        @Property(name = "product")
        var product: String? = null,

        @Property(name = "cpe")
        var cpe: String? = null,

        @Property(name = "update")
        var update: String? = null,

        @Property(name = "version")
        var version: String? = null,

        @Relationship(type = "Affects", direction = Relationship.INCOMING)
        var cves: List<CVE>? = null,

        @Relationship(type = "Owns", direction = Relationship.INCOMING)
        var vendors: Vendor? = null,

        @Relationship(type = "IsPart", direction = Relationship.OUTGOING)
        var part: CpePart? = null)

@NodeEntity(label = "Reference")
data class Reference(
        @Property(name = "href")
        var href: String? = null,

        @Relationship(type = "IsRefType", direction = Relationship.OUTGOING)
        var refType: ReferenceType? = null,

        @Relationship(type = "FromRefSrc", direction = Relationship.OUTGOING)
        var refSrc: ReferenceSource? = null)

@NodeEntity(label = "ReferenceType")
data class ReferenceType(
        @Property(name = "refType") var refType: String? = null,
        @Relationship(type = "IsRefType", direction = Relationship.INCOMING) var ref: Reference? = null)


@NodeEntity(label = "ReferenceSource")
data class ReferenceSource(
        @Property(name = "refSrc")
        var href: String? = null,

        @Relationship(type = "FromRefSrc", direction = Relationship.INCOMING)
        var ref: Reference? = null)


@NodeEntity(label = "CWE")
data class CWE(
        @Property(name = "cweId")
        var cweId: String? = null,

        @Relationship(type = "CommonWeakness", direction = Relationship.INCOMING)
        var cves: List<CVE>? = null)

@NodeEntity(label = "Vendor")
data class Vendor(
        @Property(name = "vendorId")
        var vendorId: String? = null,

        @Relationship(type = "Owns", direction = Relationship.OUTGOING)
        var products: List<Product>? = null)

sealed class CpePart {
    @Property(name = "partId")
    var partId: String? = null

    @Relationship(type = "IsPart", direction = Relationship.INCOMING)
    var products: List<Product>? = null
}

@NodeEntity(label = "OperatingSystem")
class OperatingSystemPart : CpePart()

@NodeEntity(label = "Application")
class Application : CpePart()

@NodeEntity(label = "Hardware")
class Hardware : CpePart()
