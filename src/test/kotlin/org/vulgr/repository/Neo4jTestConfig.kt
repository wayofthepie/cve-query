package org.vulgr.repository

import org.neo4j.ogm.session.SessionFactory
import org.springframework.boot.autoconfigure.EnableAutoConfiguration
import org.springframework.context.annotation.*
import org.springframework.data.neo4j.repository.config.EnableNeo4jRepositories
import org.springframework.transaction.annotation.EnableTransactionManagement

@Configuration
@EnableTransactionManagement
@EnableAutoConfiguration
@ComponentScan(basePackages = arrayOf("org.vulgr"))
@EnableNeo4jRepositories(basePackages = arrayOf("org.vulgr.repository"))
@Profile("embedded", "test")
class Neo4jTestConfig {

    @Bean
    @Primary
    fun getConfiguration(): org.neo4j.ogm.config.Configuration {
        return org.neo4j.ogm.config.Configuration.Builder().build()
    }

    @Bean
    @Primary
    fun getSessionFactory(): SessionFactory {
        return SessionFactory(getConfiguration(), "org.vulgr.repository")
    }
}